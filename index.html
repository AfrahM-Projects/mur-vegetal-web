<!-- ... Le <head> et tout le style CSS RESTE COMME TU L'AS MIS ... -->

<!-- CONTENU BODY + SCRIPT -->
<script>
  const identifiants = {
    utilisateur: "admin",
    motdepasse: "1234"
  };

  let websocket;

  function verifierConnexion() {
    const login = document.getElementById("login").value;
    const motdepasse = document.getElementById("motdepasse").value;

    if (login === identifiants.utilisateur && motdepasse === identifiants.motdepasse) {
      document.getElementById("loginBox").classList.remove("active");
      document.getElementById("appInterface").classList.add("active");
      demarrerWebSocket();
    } else {
      document.getElementById("erreur").textContent = "‚ùå Identifiants incorrects !";
    }
  }

  function chargerDonnees() {
    // Optionnel : envoyer un message au serveur si besoin.
    if (websocket && websocket.readyState === WebSocket.OPEN) {
      console.log("üîÑ Requ√™te de rafra√Æchissement envoy√©e.");
      websocket.send(JSON.stringify({ action: "refresh" }));
    } else {
      console.warn("‚ö†Ô∏è WebSocket non connect√©.");
    }
  }

  function demarrerWebSocket() {
    websocket = new WebSocket("ws://localhost:8765");

    const etatSysteme = document.getElementById("etatSysteme").querySelector("span");
    const humidite = document.getElementById("humidite").querySelector("span");
    const luminosite = document.getElementById("luminosite").querySelector("span");
    const air = document.getElementById("air").querySelector("span");
    const temperature = document.getElementById("temperature").querySelector("span");
    const derniereMaj = document.getElementById("derniereMaj");

    websocket.onopen = () => {
      etatSysteme.textContent = "√âtat du syst√®me : Connect√© au serveur WebSocket ‚úÖ";
    };

    websocket.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);

        if (data.humidite) humidite.textContent = "Humidit√© : " + data.humidite + " %";
        if (data.luminosite) luminosite.textContent = "Luminosit√© : " + data.luminosite + " lux";
        if (data.air) air.textContent = "Qualit√© de l'air : " + data.air;
        if (data.temperature) temperature.textContent = "Temp√©rature : " + data.temperature + " ¬∞C";

        derniereMaj.textContent = "Derni√®re mise √† jour : " + new Date().toLocaleString();
        etatSysteme.textContent = "√âtat du syst√®me : Donn√©es mises √† jour ‚úÖ";
      } catch (e) {
        console.error("Erreur parsing donn√©es WebSocket :", e);
      }
    };

    websocket.onerror = () => {
      etatSysteme.textContent = "√âtat du syst√®me : Erreur WebSocket ‚ùå";
    };

    websocket.onclose = () => {
      etatSysteme.textContent = "√âtat du syst√®me : Connexion WebSocket ferm√©e ‚ùå";
    };
  }

  function activerArrosage() {
    alert("üíß Syst√®me d‚Äôarrosage activ√© !");
    document.getElementById("etatSysteme").querySelector("span").textContent = "√âtat du syst√®me : Arrosage en cours...";
    // Tu peux envoyer un message WebSocket ici si tu veux notifier le backend
    if (websocket && websocket.readyState === WebSocket.OPEN) {
      websocket.send(JSON.stringify({ action: "arrosage" }));
    }
  }

  function toggleMode() {
    document.body.classList.toggle("dark-mode");
  }

  function seDeconnecter() {
    if (websocket) websocket.close();
    document.getElementById("appInterface").classList.remove("active");
    document.getElementById("loginBox").classList.add("active");
    document.getElementById("login").value = "";
    document.getElementById("motdepasse").value = "";
    document.getElementById("erreur").textContent = "";
    document.body.classList.remove("dark-mode");
  }
</script>
